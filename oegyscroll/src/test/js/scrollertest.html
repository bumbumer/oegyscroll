<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" 
                    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>

<link rel="stylesheet" href="qunit.css" type="text/css" media="screen" />
<script type="text/javascript" src="jquery-1.3.2.js"></script>
<script type="text/javascript" src="qunit.js"></script>
<script type="text/javascript" src="../../main/java/org/laughingpanda/wicket/scroller.js"></script>
<script language="javascript">
  var clicked = new Array();

  $(document).ready(function(){	
	test("clicks visible placeholders at start", function() {
		withFullLoadedBlock();
		checkScrollPosition('scroller', 'content');
		equals(clicked[1], true, "First placeholder should be clicked" );
		equals(clicked[2], false, "Second placeholder should not be clicked" );  
	});

	test("clicks visible placeholders when scrolling", function() {
		withFullLoadedBlock();
		$('#scroller').attr('scrollTop', 10);
		checkScrollPosition('scroller', 'content');
		equals(clicked[2], true, "Second placeholder should be clicked" );
		equals(clicked[3], false, "Third placeholder should not be clicked" );  
	});
	
	test("clicks only visible placeholders when scrolling further", function() {
		withFullLoadedBlock();
		$('#scroller').attr('scrollTop', 200);
		checkScrollPosition('scroller', 'content');
		equals(clicked[3], false, "3rd placeholder should not be clicked" );  
		equals(clicked[4], true, "4th placeholder should be clicked" );  
		equals(clicked[5], true, "5th placeholder should be clicked" );  
		equals(clicked[6], false, "6th placeholder should not be clicked" );  
	});
	
	function withFullLoadedBlock() {
		$('div#scroller').remove()
		var content = createOegyScroll();		
		createLoadedBlock(1, 2).appendTo(content);
		for (var i = 1; i <= 10; i++) {
			createTestPlaceHolder(i).appendTo(content);
		}
	}
	
	function createTestPlaceHolder(i) {
		clicked[i] = false;
		onclick = function(){clicked[i] = true};
		return createPlaceHolderBlock('placeholder-' + i, onclick);
	}	
			
	blockHeight = 50;
	blockSize = 2;
	
	function createOegyScroll() {
		var oegyScroll = $('<div id="scroller" style="height:100px;overflow:auto;border:1px solid #ccc;"></div>').appendTo($('body'))
		var scrollable = $('<div class="scrollable-area"></div>').appendTo(oegyScroll)
		var contentTable = $('<table id="content"></table>').appendTo(scrollable)
		return contentTable;
	}	
	
	function content() {
		return $('table#content')	
	}
	
	function createBlock(contentCreator) {
		var block = $("<tbody></tbody>")
		contentCreator(block);
		return block;
	}
	
	function createPlaceholder(id) {
		return $('<tr id="' + id + '" class="loader-placeholder" style="height: ' + blockHeight + 'px"><td>Placeholder ' + id + '</td></tr>');
	}
	
	function createRow(text) {
		rowHeight = blockHeight / blockSize;
		return $('<tr class="loaded-row" style="height: ' + rowHeight + 'px"><td>' + text + '</td></tr>');
	}

	function createLoadedBlock(first, last) {
		return createBlock(function(block){
			for (index = first; index <= last; index ++) {
				createRow("Row " + index).appendTo(block)
			}
		});
	}
	
	function createPlaceHolderBlock(id, onclickFunction) {
		var placeHolder = createPlaceholder(id);		
		var block = createBlock(function(block){
			placeHolder.appendTo(block)
		});
		placeHolder.get(0).onclick=onclickFunction;
		return block;
	}		
  });
</script>
  
</head>
<body>
	<h1 id="qunit-header">Oegyscroll Javascript Test</h1>
	<h2 id="qunit-banner"></h2>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
</body>
</html>
